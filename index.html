<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Kalender</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
<div class="hover-zone"></div>

<aside class="sidebar">
  <h1 class="logo">Smart Kalender</h1>

  <nav class="menu">
    <a href="#" class="active" data-view="calendar">Kalender</a>
    <a href="#" data-view="notes">Anteckningar</a>
  </nav>

  <button class="upcoming-btn">Kommande aktivitet</button>

  <div class="weather">
    <div class="temp" id="temp">--°</div>
    <div class="status" id="weather-status">Laddar väder…</div>
  </div>
</aside>

<main class="content">

<header class="topbar">
  <div class="left" style="display: flex; align-items: center; gap: 10px;">
    <!-- Dagens datum -->
    <span id="today-date"></span>

    <!-- Veckodropdown direkt bredvid datumet -->
    <div class="week-menu-wrapper" style="position: relative; display: inline-block;">
        <span id="week-number" style="cursor: pointer;">Vecka 1</span>
        <ul id="week-menu" class="week-menu"></ul>
    </div>

    <!-- Klocka -->
    <span id="current-time"></span>
  </div>
</header>

<section id="calendar-view" class="view active-view">
  <div class="calendar">
    <div id="calendarGrid" class="calendar-grid">
  </div>
</section>

<section class="notes view" id="notes-view">
  <textarea id="notesArea" placeholder="Skriv dina anteckningar här..."></textarea>
  <div class="notes-actions">
    <button class="save secondary">Spara som</button>
    <button class="save primary" id="saveNotes">Spara</button>
  </div>
</section>

<script>
let weekOffset = 0;

function getWeekNumber(date) {
  const d = new Date(date);
  d.setDate(d.getDate() + 3 - (d.getDay() + 6) % 7);
  const week1 = new Date(d.getFullYear(), 0, 4);
  return 1 + Math.round(((d - week1) / 86400000 - 3 + (week1.getDay() + 6) % 7) / 7);
}

function updateDateTime() {
  const now = new Date();
  const shown = new Date(now);
  shown.setDate(shown.getDate() + weekOffset * 7);

  document.getElementById('today-date').textContent =
    shown.toLocaleDateString('sv-SE', { weekday:'long', day:'numeric', month:'long' });

  document.getElementById('current-time').textContent =
    now.toLocaleTimeString('sv-SE', { hour:'2-digit', minute:'2-digit' });

  document.getElementById('week-number').textContent =
    `Vecka ${getWeekNumber(shown)}`;
}

updateDateTime();
setInterval(updateDateTime, 1000);

const weekNumber = document.getElementById('week-number');
const weekMenu = document.getElementById('week-menu');

// Fyll veckor 1–52
for (let i = 1; i <= 52; i++) {
  const li = document.createElement('li');
  li.textContent = `Vecka ${i}`;
  li.onclick = (e) => {
    weekOffset = i - getWeekNumber(new Date()); // justera kalendern
    buildCalendar();
    weekMenu.style.display = 'none';
  };
  weekMenu.appendChild(li);
}

// Visa/dölj menyn
weekNumber.onclick = (e) => {
  e.stopPropagation();
  weekMenu.style.display = weekMenu.style.display === 'block' ? 'none' : 'block';
};

// Klick utanför stänger menyn
document.addEventListener('click', () => {
  weekMenu.style.display = 'none';
});


const grid = document.getElementById('calendarGrid');

function buildCalendar() {
  grid.innerHTML = `
    <div class="cell header"></div>
    <div class="cell header">Måndag</div>
    <div class="cell header">Tisdag</div>
    <div class="cell header">Onsdag</div>
    <div class="cell header">Torsdag</div>
    <div class="cell header">Fredag</div>
    <div class="cell header">Lördag</div>
    <div class="cell header">Söndag</div>
  `;

  const events = JSON.parse(localStorage.getItem('events') || '{}');

  for (let h = 0; h <= 23; h++) {
    const time = document.createElement('div');
    time.className = 'time';
    time.textContent = `${String(h).padStart(2,'0')}:00`;
    grid.appendChild(time);

    for (let d = 0; d < 7; d++) {
      const cell = document.createElement('div');
      cell.className = 'cell event-cell';
      const id = `${weekOffset}-${h}-${d}`;

      if (events[id]) {
        const ev = document.createElement('div');
        ev.className = 'event';
        ev.textContent = events[id];
        cell.appendChild(ev);
      }

      // Klick på cellen
      cell.onclick = () => {
        if (events[id]) {
          // Om det redan finns ett event, fråga om man vill ta bort det
          const remove = confirm("Vill du ta bort detta event?");
          if (remove) {
            delete events[id];
            localStorage.setItem('events', JSON.stringify(events));
            buildCalendar();
          }
          return; // stoppar här
        }

        // Om ingen titel finns, fråga efter ny titel
        const title = prompt('Eventtitel:');
        if (!title) return;
        events[id] = title;
        localStorage.setItem('events', JSON.stringify(events));
        buildCalendar();
      };

      grid.appendChild(cell);
    }
  }

  updateDateTime();
}


buildCalendar();

const notesArea = document.getElementById('notesArea');
notesArea.value = localStorage.getItem('notes') || '';

document.getElementById('saveNotes').onclick = () => {
  localStorage.setItem('notes', notesArea.value);
  alert('Anteckningar sparade!');
};

fetch('https://api.open-meteo.com/v1/forecast?latitude=59.33&longitude=18.07&current_weather=true')
  .then(r => r.json())
  .then(d => {
    document.getElementById('temp').textContent =
      Math.round(d.current_weather.temperature) + '°';
    document.getElementById('weather-status').textContent = 'Nuvarande väder';
  });

document.querySelectorAll('.menu a').forEach(link => {
  link.onclick = e => {
    e.preventDefault();
    document.querySelectorAll('.menu a').forEach(l => l.classList.remove('active'));
    link.classList.add('active');
    document.querySelectorAll('.view').forEach(v => v.classList.remove('active-view'));
    document.getElementById(link.dataset.view + '-view').classList.add('active-view');
  };
});
</script>

</main>
</body>
</html>
